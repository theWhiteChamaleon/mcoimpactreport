"use strict";(self.webpackChunkreact_widget_template=self.webpackChunkreact_widget_template||[]).push([[5],{7217:(e,t,o)=>{o.r(t),o.d(t,{default:()=>G});var s=o(5043),n=o(4391),l=(o(2342),o(9555),o(3003)),a=o(2670),r=o(2115),i=(o(8421),o(4050),o(9959),o(2725)),c=o(6713),d=o(7419),u=o(579);var m=o(9379),p=(o(4816),o(3637)),v=o(1238),h=o(2450);const g=e=>{let{columns:t,data:o}=e;const[n,l]=(0,s.useState)(""),[a,r]=(0,s.useState)(1),[i,c]=(0,s.useState)((()=>{const e={};return Array.isArray(t)&&t.forEach((t=>{e[t.accessorKey]=t.defaultWidth||150})),e})),d=(0,s.useRef)(null),p=(0,s.useRef)(0),g=(0,s.useRef)(0),f=(0,s.useCallback)(((e,t)=>{d.current=t,p.current=e.clientX,g.current=i[t],document.addEventListener("mousemove",y),document.addEventListener("mouseup",A)}),[i]),y=(0,s.useCallback)((e=>{if(null===d.current)return;const t=e.clientX-p.current,o=Math.max(50,g.current+t);c((e=>(0,m.A)((0,m.A)({},e),{},{[d.current]:o})))}),[]),A=(0,s.useCallback)((()=>{d.current=null,p.current=0,g.current=0,document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",A)}),[y]),x=(0,s.useMemo)((()=>Array.isArray(o)?o.filter((e=>Array.isArray(t)&&t.some((t=>String(e[t.accessorKey]||"").toLowerCase().includes(n.toLowerCase()))))):[]),[n,o,t]),S=(0,s.useMemo)((()=>{const e=10*(a-1);return Array.isArray(x)?x.slice(e,e+10):[]}),[x,a]),b=Math.ceil(x.length/10);return(0,u.jsxs)("div",{className:"container-fluid p-0 mt-3",children:[(0,u.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[(0,u.jsx)("input",{type:"text",className:"form-control w-25",placeholder:"Search...",value:n,onChange:e=>l(e.target.value)}),(0,u.jsx)("button",{className:"btn btn-success",onClick:()=>{if(!Array.isArray(x)||0===x.length)return void console.warn("No data to export.");const e=v.Wp.json_to_sheet(x),t=v.Wp.book_new();v.Wp.book_append_sheet(t,e,"Sheet1");const o=v.M9(t,{bookType:"xlsx",type:"array"}),s=new Blob([o],{type:"application/octet-stream"});(0,h.saveAs)(s,"exported-data.xlsx")},children:"Export to Excel"})]}),(0,u.jsx)("div",{className:"table-responsive",children:(0,u.jsxs)("table",{className:"table custom-table table-hover",children:[(0,u.jsx)("thead",{className:"thead-light",children:(0,u.jsx)("tr",{children:Array.isArray(t)&&t.map((e=>(0,u.jsxs)("th",{style:{width:i[e.accessorKey]+"px"},children:[e.header,(0,u.jsx)("div",{className:"resizer",onMouseDown:t=>f(t,e.accessorKey)})]},e.accessorKey)))})}),(0,u.jsx)("tbody",{children:Array.isArray(S)&&S.length>0?S.map(((e,o)=>(0,u.jsx)("tr",{children:Array.isArray(t)&&t.map((t=>(0,u.jsx)("td",{style:{width:i[t.accessorKey]+"px"},children:e[t.accessorKey]},t.accessorKey)))},o))):(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:Array.isArray(t)?t.length:1,className:"text-center",children:"No data found."})})})]})}),(0,u.jsxs)("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[(0,u.jsxs)("p",{className:"mb-0",children:["Showing ",10*(a-1)+1," to"," ",Math.min(10*a,x.length)," of"," ",x.length," entries"]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("button",{className:"btn btn-outline-primary mx-1",disabled:1===a,onClick:()=>r((e=>e-1)),children:"Prev"}),(0,u.jsx)("span",{children:a}),(0,u.jsx)("button",{className:"btn btn-outline-primary mx-1",disabled:a===b,onClick:()=>r((e=>e+1)),children:"Next"})]})]})]})},f=e=>{let{columns:t,data:o}=e;const[n,l]=(0,s.useState)(""),[a,r]=(0,s.useState)(1),[i,c]=(0,s.useState)((()=>{const e={};return Array.isArray(t)&&t.forEach((t=>{e[t.accessorKey]=t.defaultWidth||150})),e})),d=(0,s.useRef)(null),p=(0,s.useRef)(0),g=(0,s.useRef)(0),f=(0,s.useCallback)(((e,t)=>{e.preventDefault(),d.current=t,p.current=e.clientX,g.current=i[t],document.addEventListener("mousemove",y),document.addEventListener("mouseup",A)}),[i]),y=(0,s.useCallback)((e=>{if(null===d.current)return;const t=e.clientX-p.current,o=Math.max(50,g.current+t);c((e=>(0,m.A)((0,m.A)({},e),{},{[d.current]:o})))}),[]),A=(0,s.useCallback)((()=>{d.current=null,p.current=0,g.current=0,document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",A)}),[y]),x=(0,s.useMemo)((()=>Array.isArray(o)?o.filter((e=>Array.isArray(t)&&t.some((t=>String(e[t.accessorKey]||"").toLowerCase().includes(n.toLowerCase()))))):[]),[n,o,t]),S=(0,s.useMemo)((()=>{const e=10*(a-1);return Array.isArray(x)?x.slice(e,e+10):[]}),[x,a]),b=Math.ceil(x.length/10);return(0,u.jsxs)("div",{className:"container-fluid p-0 mt-3",children:[(0,u.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[(0,u.jsx)("input",{type:"text",className:"form-control w-25",placeholder:"Search...",value:n,onChange:e=>l(e.target.value)}),(0,u.jsx)("button",{className:"btn btn-success",onClick:()=>{if(!Array.isArray(x)||0===x.length)return void console.warn("No data to export.");const e=v.Wp.json_to_sheet(x),t=v.Wp.book_new();v.Wp.book_append_sheet(t,e,"Sheet1");const o=v.M9(t,{bookType:"xlsx",type:"array"}),s=new Blob([o],{type:"application/octet-stream"});(0,h.saveAs)(s,"exported-data.xlsx")},children:"Export to Excel"})]}),(0,u.jsx)("div",{className:"table-responsive",children:(0,u.jsxs)("table",{className:"table custom-table table-hover",children:[(0,u.jsx)("thead",{className:"thead-light",children:(0,u.jsx)("tr",{children:Array.isArray(t)&&t.map((e=>(0,u.jsxs)("th",{style:{width:i[e.accessorKey]+"px"},children:[e.header,(0,u.jsx)("div",{className:"resizer",onMouseDown:t=>f(t,e.accessorKey)})]},e.accessorKey)))})}),(0,u.jsx)("tbody",{children:Array.isArray(S)&&S.length>0?S.map(((e,o)=>(0,u.jsx)("tr",{children:Array.isArray(t)&&t.map((t=>(0,u.jsx)("td",{style:{width:i[t.accessorKey]+"px"},children:e[t.accessorKey]},t.accessorKey)))},o))):(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:Array.isArray(t)?t.length:1,className:"text-center",children:"No data found."})})})]})}),(0,u.jsxs)("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[(0,u.jsxs)("p",{className:"mb-0",children:["Showing ",10*(a-1)+1," to"," ",Math.min(10*a,x.length)," of"," ",x.length," entries"]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("button",{className:"btn btn-outline-primary mx-1",disabled:1===a,onClick:()=>r((e=>e-1)),children:"Prev"}),(0,u.jsx)("span",{children:a}),(0,u.jsx)("button",{className:"btn btn-outline-primary mx-1",disabled:a===b,onClick:()=>r((e=>e+1)),children:"Next"})]})]})]})};var y=o(759),A=o(5645);const x=(e,t,o)=>(console.log("cadata datahelpers",o),e?e.map((e=>{if("Route"===t)return{ItemName:(null===e||void 0===e?void 0:e.ItemTitle)||"N/A",ItemRev:(null===e||void 0===e?void 0:e.ItemRev)||"N/A",ItemType:(null===e||void 0===e?void 0:e.ItemType)||"N/A",ItemId:(null===e||void 0===e?void 0:e.ItemId)||"N/A",ItemSeq:(null===e||void 0===e?void 0:e.ItemSeq)||"N/A",ItemMakeBuy:(null===e||void 0===e?void 0:e.ItemMBOM)||"N/A",ItemNextSeqMCO:(null===e||void 0===e?void 0:e.ItemNextSeqMCO)||"N/A",ItemPrevSeqMCO:(null===e||void 0===e?void 0:e.ItemPrevSeqMCO)||"N/A"}})):[]),S=(e,t,o)=>(console.log("cadata datahelpers",o),e?e.map((e=>{if("Route"===t)return{ItemFromName:(null===e||void 0===e?void 0:e.ItemFromTitle)||"N/A",ItemToName:(null===e||void 0===e?void 0:e.ItemToTitle)||"N/A",ItemRev:(null===e||void 0===e?void 0:e.ItemRev)||"N/A",ItemType:(null===e||void 0===e?void 0:e.ItemType)||"N/A",ItemId:(null===e||void 0===e?void 0:e.ItemId)||"N/A",ItemSeq:(null===e||void 0===e?void 0:e.ItemSeq)||"N/A",ItemNextSeqMCO:(null===e||void 0===e?void 0:e.ItemNextSeqMCO)||"N/A",ItemPrevSeqMCO:(null===e||void 0===e?void 0:e.ItemPrevSeqMCO)||"N/A"}})):[]);var b=o(6244),C=o(9332),I=o(5072),w=o(9269),N=o(4392),M=o(3277),j=o(2268),D=o(6047);const P=()=>{const{showErrorToast:e}=(0,i.A)(),t=(0,l.wA)();let o=window.widget.getValue("email");console.log("Email in usePlantAssignment:",o);return{handlePlantAssignment:async(s,n,l,a,r)=>{try{t((0,A.Ve)(!0));const i=await(0,j.I)();if(!i)return void e(M.rK);console.log("[UsePlantAssignment] Headers:",i);let c=[],d=[];if("Route"===a){console.log("Type begining className",r);let e=!1,o="";console.log("The object Type is Route");const n=async()=>{const e="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dsrt/routes/".concat(l,"/contents"),t=await(0,D.ui)("GET",e,"",i);console.log("Response from route URL:",t.output),t.status&&t.output&&(o=t.output.data[0].id);const s="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dslc/changeaction/".concat(o,"?%24fields=proposedChanges,realizedChanges"),n=await(0,D.ui)("GET",s,"",i);if(console.log("Response from Change Action URL:",n),n.status&&n.output){const e=n.output.proposedChanges.map((async e=>{var t;let o=e.where.identifier,s=e.where.type;console.log("line number 91",r);const n=await async function(e,t,o){let s="",n="",l="";console.log("mcoName",o);let a=o.split("-")[2];console.log("className in PREV Sequence",a);const r=await O(e,t);if(r){var i,c;let x=r.identifier;const S=await q(x,t,a);var d;if(console.log("classAttr -- 1 -- ",S),(null===(i=S[0])||void 0===i?void 0:i.McoName)===o)if(null!==(d=S[0])&&void 0!==d&&d.PrevSeq){var u,m;s=null===(u=S[0])||void 0===u?void 0:u.PrevSeq.split("-")[0],l=null===(m=S[0])||void 0===m?void 0:m.PrevSeq.split("-")[5],console.log("prevSeqMCO",s),console.log("MCOSeq",l)}else{var p;const o=await R(e,a,t,"previousSeq");var v,h;if(null!==(p=o[0])&&void 0!==p&&p.PrevSeq)l=null===(v=o[0])||void 0===v?void 0:v.Seq,s=null===(h=o[0])||void 0===h?void 0:h.McoName,console.log("prevSeqMCO in case 1",s),console.log("MCOSeq in case 1",l);else console.log("Previous revision does NOT exist for identifier ".concat(e)),s="",l=""}const b=null===(c=S[0])||void 0===c?void 0:c.PrevSeq;let C="",I="";if(!b)return;const w=b.split(",").map((e=>e.trim()));console.log("entries",w);const N=w.find((e=>{console.log("entry",e);const t=e.split("-");console.log("parts",t);const s=t.slice(0,3).join("-");return console.log("firstThree",s),console.log("mcoName",o),s===o}));if(console.log("matchedEntry",N),N){const e=w.indexOf(N);if(-1!==e){const t=e>0?e-1:null,o=e<w.length-1?e+1:null;C=null!==t?w[t]:null,I=null!==o?w[o]:null;const n=C.split("-");s=n.slice(0,3).join("-"),console.log("CASE 2 3rd point prevSeqMCO",s),l=n[n.length-2],console.log("CASE 2 3rd point MCOSeq",l)}}else{var g,f;const o=await R(e,a,t,"previousSeq");console.log("Case 2 4th point",o),s=null===(g=o[0])||void 0===g?void 0:g.PrevSeq.split("-")[0],l=null===(f=o[0])||void 0===f?void 0:f.PrevSeq.split("-")[5],console.log("Case 2 4th point prevSeqMCO",s),console.log("Case 2 4th point MCOSeq",l)}if(I){console.log("nextValueInPreviousSequence in Case 2 5th point",I);const e=I.split("-");n=e.slice(0,3).join("-"),console.log("CASE 2 5th point nextSeqMCO",n),l=e[e.length-2],console.log("CASE 2 5th point MCOSeq",l)}else{var y,A;const o=await R(e,a,t,"nextSeq");console.log("Case 2 4th point",o),n=null===(y=o[0])||void 0===y?void 0:y.PrevSeq.split("-")[0],l=null===(A=o[0])||void 0===A?void 0:A.PrevSeq.split("-")[5],console.log("Case 2 4th point prevSeqMCO",n),console.log("Case 2 4th point MCOSeq",l)}}}(o,i,r),l=null===n||void 0===n?void 0:n.nextSeqMCO,a=null===n||void 0===n?void 0:n.prevSeqMCO,u=(null===n||void 0===n||n.MCOSeq,await async function(e,t){let o="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dsmfg/dsmfg:MfgItem/".concat(e,"/expand?$mask=dsmfg:MfgItem.ExpandMask.Default.V1");const s={expandDepth:1,withPath:!1};try{const a=await(0,D.ui)("POST",o,s,t);if(console.log("expandItms --1-- ",null===a||void 0===a?void 0:a.output),a.status&&a.output){var n;const e=[],t=null===a||void 0===a||null===(n=a.output)||void 0===n?void 0:n.totalItems;for(let o=0;o<t;o++){var l;const t=null===a||void 0===a||null===(l=a.output)||void 0===l?void 0:l.member[o],s={id:t.id,type:t.type,title:t.title};"CreateAssembly"!==t.type&&"Provide"!==t.type||e.push(s)}return console.log("expandItmArray ---- ",e),{expandItmArray:e}}return console.log("No valid response for identifier ".concat(e)),{}}catch(a){return console.error("Error fetching item details for ".concat(e,":"),a),{}}}(o,i));console.log("expandItemDetails ----",u);let m=null===u||void 0===u?void 0:u.expandItmArray.length,p=null===u||void 0===u||null===(t=u.expandItmArray[0])||void 0===t?void 0:t.title,v="";m>1&&(v=p);for(let I=0;I<m;I++){var h,g;let e=null===u||void 0===u||null===(h=u.expandItmArray[I])||void 0===h?void 0:h.id,t=null===u||void 0===u||null===(g=u.expandItmArray[I])||void 0===g?void 0:g.type;const n=await O(e,i);console.log("engItemDetails Details are:",n);let m=n.identifier;if(void 0!==m&&void 0!==o&&void 0!==s)try{const[s,n]=await Promise.all([q(m,i,r.split("-")[2]),E(e,t,i)]);var f,y,A,x,S,b;if(console.log("ItemPlants --- ",s),console.log("Iteminfo --- ",n),o===(null===n||void 0===n?void 0:n.member[0].id))c.push({ItemId:e,ItemType:t,ItemState:(null===n||void 0===n?void 0:n.member[0].state)||"N/A",ItemTitle:(null===n||void 0===n?void 0:n.member[0].title)||"N/A",ItemRev:(null===n||void 0===n?void 0:n.member[0].revision)||"N/A",ItemMBOM:!0===(null===(f=s[0])||void 0===f?void 0:f.MBOM)?"Make":"Buy",ItemSeq:(null===(y=s[0])||void 0===y?void 0:y.Seq)||"N/A",ItemPrevSeqMCO:a||"N/A",ItemNextSeqMCO:l||"N/A"});if(v&&v!==(null===n||void 0===n?void 0:n.member[0].title))d.push({ItemId:e,ItemType:t,ItemState:(null===n||void 0===n?void 0:n.member[0].state)||"N/A",ItemFromTitle:v||"N/A",ItemToTitle:(null===n||void 0===n?void 0:n.member[0].title)||"N/A",ItemMBOM:(null===n||void 0===n||null===(A=n.member[0])||void 0===A||null===(x=A["dseno:EnterpriseAttributes"])||void 0===x?void 0:x.EMR_hasMBOM)||"N/A",ItemSeq:(null===(S=s[0])||void 0===S?void 0:S.Seq)||"N/A",ItemPrevSeqMCO:a||"N/A",ItemNextSeqMCO:l||"N/A",ItemERPStatus:(null===(b=s[0])||void 0===b?void 0:b.PlantERPStatus)||"N/A"});console.log("MCA ItemDetails",c),console.log("MCA ItemDetails2",d)}catch(C){console.error("Error processing change for item ".concat(e,":"),C)}}}));await Promise.all(e)}else console.error("Invalid response structure or no proposed changes.")},a=async()=>{const e=await(0,C.g)([s],i,l);console.log("Parallel API response:",e),t((0,A.QL)(e))};await Promise.all([n(),a()]),t((0,A.nN)(c)),t((0,A.lQ)(d)),t((0,A.Dr)(e))}else{const e=await(0,b.o)(i,l,o);console.log("[Plant Assignment] User Groups:",e);let r=[...e,s];console.log("[Use Plant Assignment] All CollabSpaces:",r);let c=[];if(r.length>0?(c=await(0,C.g)(r,i,l),console.log("[Use Plant Assignment] All Plants:",c)):console.warn("[Use Plant Assignment] No CollabSpaces found."),c.length>0){const e=await(0,N.d)(c,i,l);console.log("[Use Plant Assignment]: ",e),e.success?(t((0,A.Lq)(e.data.plantData)),t((0,A.lL)(i))):console.error("Failed to fetch plant data.")}else console.warn("[Use Plant Assignment] No Plants found.");let d={};d="Raw_Material"===a?{success:!0,data:[]}:await(0,I.P)(i,l,a),console.log("Type After:",a),console.log("[Use Plant Assignment] Product Children:",d),d.success&&t((0,A.VG)(d.data));const u=await(0,w.B)(i,l,n);console.log("[Use Plant Assignment] CA Details:",u),u.success&&(t((0,A.ug)(u.data)),t((0,A.aB)(u.proposedChanges)),t((0,A.hF)(u.CAData))),console.log("[Plant Assignment] All services executed successfully.")}}catch(i){console.error("[Plant Assignment] Error:",i),e("An error occurred while fetching plant assignment data.")}finally{t((0,A.Ve)(!1))}}}};async function q(e,t,o){const s=[];let n;o&&(n=await async function(e,t){let o;try{var s,n;const h="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dslib/dslib:Library/search?$searchStr=Micro Motion",g=await(0,D.ui)("GET",h,"",e);if(console.log("Response from getClassId:",g),g&&null!==g&&void 0!==g&&g.output&&null!==g&&void 0!==g&&null!==(s=g.output)&&void 0!==s&&s.member){var l;const s=null===g||void 0===g||null===(l=g.output)||void 0===l?void 0:l.member.find((e=>"Micro Motion"===e.title));if(s.id){var a;const n="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dslib/dslib:Library/".concat(s.id,"?$mask=dslib:ExpandClassesDetailsMask"),l=await(0,D.ui)("GET",n,"",e);if(console.log("Library Response:",l),l&&null!==l&&void 0!==l&&l.output&&null!==l&&void 0!==l&&null!==(a=l.output)&&void 0!==a&&a.member){var r,i,c,d,u,m,p,v;const e=null===l||void 0===l||null===(r=l.output)||void 0===r||null===(i=r.member[0])||void 0===i||null===(c=i.ChildClasses)||void 0===c||null===(d=c.member)||void 0===d?void 0:d.find((e=>"Factories"===e.title));console.log("Class Item:",e),console.log("classItem.member",null===(u=e.ChildClasses)||void 0===u?void 0:u.member),o=null===(m=e.ChildClasses)||void 0===m||null===(p=m.member)||void 0===p?void 0:p.find((e=>e.title===t)),console.log("Class ID:",null===(v=o)||void 0===v?void 0:v.id)}}}return(null===(n=o)||void 0===n?void 0:n.id)||null}catch(h){console.error("Error fetching class ID:",h)}}(t,o)),console.log("className",o),console.log("classIdFromLibrary",n);try{const o="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dslib/dslib:ClassifiedItem/".concat(e,"?$mask=dslib:ClassificationAttributesMask"),n=await(0,D.ui)("GET",o,"",t);var l,a,r;if(console.log("Response for identifier ".concat(e,":"),n),null!==n&&void 0!==n&&n.status)null===n||void 0===n||null===(l=n.output)||void 0===l||null===(a=l.member[0])||void 0===a||null===(r=a.ClassificationAttributes)||void 0===r||r.member.forEach((e=>{const t=e.ClassID;let o=null,n=null,l=null,a=null;e.Attributes.forEach((e=>{e.name.includes("EMRPlantSequence")&&(o=e.value),e.name.includes("EMRMCOName")&&(n=e.value),e.name.includes("EMRPlantMBOM")&&(l=e.value),e.name.includes("EMRPlantPreviousSequence")&&(a=e.value)})),s.push({PlantID:t,Seq:o,McoName:n,MBOM:l,PrevSeq:a})}))}catch(i){console.error("Error fetching assigned classes for ".concat(e,":"),i)}return s}async function E(e,t,o){let s="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dsmfg/dsmfg:MfgItem/".concat(e,"?mask=dsmfg:MfgItemMask.Details");try{const t=await(0,D.ui)("GET",s,"",o);return t.status&&t.output?t.output:(console.log("No valid response for identifier ".concat(e)),{})}catch(n){return console.error("Error fetching item details for ".concat(e,":"),n),{}}}async function O(e,t){let o="";o="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dsmfg/dsmfg:MfgItem/".concat(e,"/dsmfg:ScopeEngItem");try{const s=await(0,D.ui)("GET",o,"",t);return s.status&&s.output?{identifier:s.output.member[0].ScopeEngItem.identifier,type:s.output.member[0].ScopeEngItem.type}:(console.log("No valid response for identifier ".concat(e)),{})}catch(s){return console.error("Error fetching item details for ".concat(e,":"),s),{}}}async function R(e,t,o,s){try{let n="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dslc/version/getGraph";const l={data:[{id:e,identifier:e,type:"CreateAssembly",source:"https://oi000186152-us1-space.3dexperience.3ds.com/enovia",relativePath:"/resources/v1/modeler/dsmfg/dsmfg:MfgItem/".concat(e)}]},a=await(0,D.ui)("POST",n,l,o);if(console.log("getPrevSeqMCO --1-- ",null===a||void 0===a?void 0:a.output),a.status){let n;if("previousSeq"===s?n=await function(e,t){var o,s;if(null===e||void 0===e||null===(o=e.results)||void 0===o||!o.length)return null;const n=(null===(s=e.results[0])||void 0===s?void 0:s.versions)||[],l=n.find((e=>e.identifier===t));if(!l)return null;const a=function(e){if(/^\d+$/.test(e)){const t=parseInt(e,10);if(t<=1)return null;const o=t-1;return e.length>1?String(o).padStart(e.length,"0"):String(o)}if(/^[A-Z]+$/.test(e))return function(e){let t=e.split(""),o=t.length-1;for(;o>=0;){if("A"!==t[o])return t[o]=String.fromCharCode(t[o].charCodeAt(0)-1),t.join("");if(0===o)return null;t[o]="Z",o--}if(t.length>1&&"A"===t[0]&&t.every(((e,t)=>0===t||"A"===e)))return"Z".repeat(t.length-1);return null}(e);return null}(l.revision);if(null===a)return null;const r=n.find((e=>e.revision===a));return r?r.identifier:null}(a.output,e):"nextSeq"===s&&(n=await function(e,t){var o,s;if(null===e||void 0===e||null===(o=e.results)||void 0===o||!o.length)return null;const n=(null===(s=e.results[0])||void 0===s?void 0:s.versions)||[],l=n.find((e=>e.identifier===t));if(!l)return null;const a=function(e){if(/^\d+$/.test(e)){const t=parseInt(e,10)+1;return e.length>1?String(t).padStart(e.length,"0"):String(t)}if(/^[A-Z]+$/.test(e))return function(e){let t=e.split(""),o=t.length-1;for(;o>=0;){if("Z"!==t[o])return t[o]=String.fromCharCode(t[o].charCodeAt(0)+1),t.join("");t[o]="A",o--}return"A"+t.join("")}(e);return e}(l.revision),r=n.find((e=>e.revision===a));return r?r.identifier:null}(a.output,e)),n){const e=await O(n,o);if(e){let s=e.identifier;const n=await q(s,o,t);return console.log("classAttr -- 2 -- ",n),n}}}}catch(n){console.log("error in getPrevAndNextSeqMCO",n)}}var T=o(314);const k=()=>{const{showErrorToast:e}=(0,i.A)(),{handlePlantAssignment:t}=P(),o=(0,l.d4)((e=>e.droppedObject.isDropped)),n=(0,l.d4)((e=>e.droppedObject.loading)),a=(0,l.wA)(),r=(0,s.useCallback)((async o=>{try{const r=await(0,T.Sj)({dataItems:o});if(r.success){a((0,A.um)({cardData:r.data.cardData}));const e=r.data.cardData;var s,n,l;if(console.log("[Dragged Items are]",e),a((0,A.Rr)(!0)),r)await t(e["Collaborative Space"],e["Maturity State"],null===(s=o[0])||void 0===s?void 0:s.objectId,null===(n=o[0])||void 0===n?void 0:n.objectType,null===(l=o[0])||void 0===l?void 0:l.displayName)}else e(M.wX)}catch(r){console.error("[FetchObjectDetails] Error fetching details:",r),e(M.wX)}finally{a((0,A.r1)(!1))}}),[a,t]),c=(0,s.useCallback)((async t=>{console.log("[handleDrop] handleDrop called with dataItems:",t);try{if(t&&t.length>0){var o;const s=null===(o=t[0])||void 0===o?void 0:o.objectType;if(!["Route","Change Action"].includes(s))return void e(M.Zo);a((0,A.Rr)(!0)),console.log("[handleDrop] \ud83d\udd04 Force setting `loading = true`..."),a((0,A.r1)(!1)),setTimeout((()=>a((0,A.r1)(!0))),0),await r(t)}else console.warn("[handleDrop] No data items to process.")}catch(s){console.error("[Drop] Error in handleDrop:",s),a((0,A.r1)(!1)),console.log("[handleDrop] Error in handleDrop, setting loading to false"),e(M.nz)}}),[r,e]);return{initializeDroppableArea:(0,s.useCallback)((()=>{o?console.log("[initializeDroppableArea] \u23f3 isDropped is already true. Skipping reset."):(console.log("[initializeDroppableArea] \ud83d\ude80 Resetting isDropped to false..."),a((0,A.Rr)(!1)));const t=setInterval((()=>{const o=document.querySelector(".droppable-container");o&&(clearInterval(t),(0,T.pn)(o,c,a,e))}),100);return()=>clearInterval(t)}),[c,a]),loading:n,handleDrop:c}};o(3127),o(5362),o(6313),o(3728);o(4119),o(1397);var K=o(4675);o(3910);const L=e=>{let{handleFileInputChange:t,fileInputRef:o,isFileInputDisabled:s,handleSubmit:n,isCreateButtonDisabled:l,handleReset:a}=e;const{handleDrop:r}=(0,d.A)(),{performSearch:i}=(0,K.A)();return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)("div",{className:"droppable-container mt-4",children:[(0,u.jsx)(p.A,{style:{width:"90px",height:"65px"},src:"https://thewhitechamaleon.github.io/testrapp/images/drag.png",alt:"Data Collect"}),(0,u.jsx)("span",{className:"drag-and-drop-text",children:"Drag and Drop"}),(0,u.jsx)("div",{class:"mt-3",children:(0,u.jsxs)("div",{class:"row justify-content-center",children:[(0,u.jsx)("div",{class:"col-6 col-md-auto mb-2"}),(0,u.jsx)("div",{class:"col-6 col-md-auto mb-2"})]})})]})})};var F=o(3353),B=o(5658);const _=()=>{const{showSuccessToastWithProgress:e,showErrorToastWithProgress:t}=(0,i._)(),[o,n]=(0,s.useState)(!1),[a,r]=(0,s.useState)(null),[d,v]=(0,s.useState)(!1),[h,b]=(0,s.useState)([]),{initializeDroppableArea:C,loading:I}=k(),[w,N]=(0,s.useState)(0),[M,j]=(0,s.useState)(0),[D,P]=(0,s.useState)([]),[q,E]=(0,s.useState)([]),[O,R]=(0,s.useState)([]),[T,K]=(0,s.useState)(null),[_,U]=(0,s.useState)([]),[G,W]=(0,s.useState)([]),[V,z]=(0,s.useState)([]),[$,X]=(0,s.useState)(!1),[Z,H]=(0,s.useState)(!0),{handleDrop:Y}=k(),[Q,J]=(0,s.useState)(!1),[ee,te]=(0,s.useState)(!1),[oe,se]=(0,s.useState)(!1),[ne,le]=(0,s.useState)(!1),ae=(0,l.wA)(),{showSuccessToast:re,showErrorToast:ie}=(0,i.A)();let ce=window.widget.getValue("Credentials");console.log("Security context is: ",ce);const de=(0,s.useRef)(null),ue=(0,s.useCallback)(((e,t)=>{W((o=>o.map((o=>o.ItemId===e?(0,m.A)((0,m.A)({},o),{},{ItemPlants:o.ItemPlants.map((e=>e.PlantID===t?(0,m.A)((0,m.A)({},e),{},{color:"red"===e.color?"green":"red"}):e))}):o))))}),[W]),me=(0,l.d4)((e=>e.droppedObject.droppedObjectData));console.log("droppedObjectData --145--",me);const pe=(0,l.d4)((e=>e.droppedObject.MCAItemObjectDetails.MCAItemDetails));console.log("The MCA Item Details are:",pe);const ve=(0,l.d4)((e=>e.droppedObject.MCAItemObjectDetails2.MCAItemDetails2));console.log("The MCA Item Details are:",ve);const he=(0,l.d4)((e=>e.droppedObject.loadingParentDetails));console.log("Parents Loading State:",he);const ge=(0,l.d4)((e=>e.droppedObject.isDropped)),fe=(0,l.d4)((e=>e.droppedObject.plantObjectData.CAData));console.log("The CAData is....:",fe);const ye=(0,l.d4)((e=>e.droppedObject.plantObjectData.CAName));if(console.log("[plant Assignment] CAName:",ye),(0,s.useEffect)((()=>{D.length>=0&&N((e=>e+1))}),[D]),(0,s.useEffect)((()=>{q.length>=0&&j((e=>e+1))}),[q]),me.cardData&&me.initialDraggedData){me.cardData["Maturity State"],me.cardData.HasMBOM;var Ae,xe,Se=null===(Ae=me.initialDraggedData)||void 0===Ae||null===(xe=Ae.data)||void 0===xe?void 0:xe.items[0].objectType}(0,s.useEffect)((()=>{"Route"===Se&&W(pe)}),[Se,pe]),(0,s.useEffect)((()=>{"Route"===Se&&z(ve)}),[Se,ve]),(0,s.useEffect)((()=>{ge||C()}),[ge,C]),(0,s.useEffect)((()=>{J(he)}),[he]);const be=(0,s.useMemo)((()=>x("Route"===Se?G:O,Se,fe)),[G,O,Se,fe]),Ce=(0,s.useMemo)((()=>S("Route"===Se?V:O,Se,fe)),[V,O,Se,fe]),Ie=(0,s.useMemo)((()=>(e=>{if(!e||!e.cardData)return null;const t=e.cardData;console.log("item --47--",t);let o={title:t.Name||"N/A",type:t.Type||"N/A","Maturity State":t["Maturity State"]||"N/A",owner:t.Owner||"N/A","Collaborative Space Title":t["Collaborative Space Title"]||"N/A",Description:t.Description||"N/A","Dropped Revision":t["Dropped Revision"]||"N/A","Latest Released Revision":t["Latest Released Revision"]||"N/A","CAD Format":t["CAD Format"]||"N/A",imageURL:t.imageURL||"https://oi000186152-us1-space.3dexperience.3ds.com/enovia/snresources/images/icons/large/I_VPMNavProduct108x144.png"};return"Document"!==t.Type&&(o.EIN=t.EIN||"N/A",o["CAD Format"]=t["CAD Format"]||"N/A"),o})(me)),[me]);console.log(Ie),(0,s.useEffect)((()=>{be.length>=0&&(console.log("New Table Data:",be),P(be),N((e=>e+1)))}),[be]),(0,s.useEffect)((()=>{Ce.length>=0&&(console.log("New Table Data:",Ce),E(Ce),j((e=>e+1)))}),[Ce]),(0,s.useEffect)((()=>{se(!!Ie)}),[Ie]);const we=(0,s.useMemo)((()=>((e,t)=>{if(console.log("type here is: ",t),"Route"===t)return[{accessorKey:"ItemName",header:"Name"},{accessorKey:"ItemRev",header:"Rev"},{accessorKey:"ItemType",header:"Type"},{accessorKey:"ItemPolicy",header:"Policy"},{accessorKey:"ItemMakeBuy",header:"Make/Buy"},{accessorKey:"ItemSeq",header:"Sequence"},{accessorKey:"ItemPrevSeqMCO",header:"Prev. Seq. MCO"},{accessorKey:"ItemPrevSeqStartDate",header:"Prev. Seq. Start Date"},{accessorKey:"ItemNextSeqMCO",header:"Next Seq MCO"},{accessorKey:"ItemNextSeqStartDate",header:"Next Seq Start Date"}]})(0,Se)),[ye,Se,ne,ue]),Ne=(0,s.useMemo)((()=>((e,t)=>{if(console.log("type here is: ",t),"Route"===t)return[{accessorKey:"ItemFromName",header:"From Part"},{accessorKey:"ItemToName",header:"To Part"},{accessorKey:"ItemFindNumber",header:"F/N"},{accessorKey:"ItemRefDes",header:"Ref Des"},{accessorKey:"ItemMfgUsageCode",header:"Manufacturing Usage Code"},{accessorKey:"ItemSeq",header:"Sequence"},{accessorKey:"ItemPrevSeqMCO",header:"Prev. Seq. MCO"},{accessorKey:"ItemPrevSeqStartDate",header:"Prev. Seq. Start Date"},{accessorKey:"ItemNextSeqMCO",header:"Next Seq MCO"},{accessorKey:"ItemNextSeqStartDate",header:"Next Seq Start Date"},{accessorKey:"ItemChildMCO",header:"Child MCO"},{accessorKey:"ItemChildStartDate",header:"Child Start Date"}]})(0,Se)),[ye,Se,ne,ue]);(0,s.useEffect)((()=>{console.log("[MBOMImpactReport] State Changes:",{loading:I,loadingParentDetails:he,isDropped:ge})}),[I,he,ge]);const Me=()=>{r(null),K(null),b([]),v(!1),P([]),U([]),W([]),z([]),R([]),N(0),j(0),X(!1),de.current&&(de.current.value=""),H(!0)};return console.log("Before template render :: columns ::",we),console.log("Before template render :: tableData ::",D),(0,u.jsxs)(u.Fragment,{children:[ee&&(0,u.jsx)(c.A,{}),!ge&&!I&&!Q&&(0,u.jsx)("div",{style:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between",position:"relative"},children:(0,u.jsx)(L,{handleFileInputChange:e=>{(0,B.fp)(e,b,v,ie,re,r,K,H).finally((()=>{te(!1)})),X(!0)},fileInputRef:de,isFileInputDisabled:$,handleSubmit:async()=>{if(a){te(!0);try{await(0,B.uk)(a,e,t,Me)}catch(o){console.error("Error in handleSubmit:",o)}finally{te(!1)}H(!0)}else ie("Please upload and validate a file before proceeding.")},isCreateButtonDisabled:Z,handleReset:Me})}),ge&&(0,u.jsxs)(u.Fragment,{children:[I&&(0,u.jsx)(c.A,{}),(0,u.jsx)("div",{className:"content-wrapper py-3 border-bottom",children:(0,u.jsxs)("div",{className:"d-flex ",children:[(0,u.jsx)("div",{className:" p-0 pt-4",children:(0,u.jsx)(p.A,{src:"https://thewhitechamaleon.github.io/testrapp/images/home.png",alt:"home-icon",className:"home-icon",onClick:()=>{C(),ae((0,A.Rr)(!1)),ae((0,A.um)({cardData:{},parentDetails:[],versions:[],initialDraggedData:[]})),ae((0,A.Lq)({allPlants:[],initialAssignedPlants:[],uniquePlants:[],productChildren:[],CAName:!1,headers:{},proposedChanges:[],CAData:{}})),ae((0,A.XC)({CAItemDetails:[],CAallPlants:[],CAisMFGCA:!1,CAheaders:{}})),P([]),se(!1)}})}),Ie&&(0,u.jsx)(y.A,{data:Ie,widgetType:"MBOMImpactReport"})]})}),Q?(0,u.jsx)("div",{className:"loading-indicator mt-5"}):(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)("div",{className:"wrapper-cta",style:{overflowY:"auto"},children:[(0,u.jsx)("h3",{style:{marginTop:"16px",marginLeft:"10px"},children:"Part Revisions"}),(0,u.jsx)("div",{className:"table-container1",style:{overflowY:"auto"},children:(0,u.jsx)(g,{columns:we,data:D})}),(0,u.jsx)("h3",{style:{marginTop:"16px",marginLeft:"10px"},children:"MBOM Connections"}),(0,u.jsx)("div",{className:"table-container1",style:{overflowY:"auto"},children:(0,u.jsx)(f,{columns:Ne,data:q})})]})})]}),(0,u.jsx)(F.A,{show:d,onHide:()=>v(!1),errors:h})]})};let U=null;function G(){if(window.widget){let e=!1;window.widget.addEvent("onLoad",(()=>{e?console.warn("[index.js] \u23f3 onLoad was already executed. Ignoring duplicate trigger."):(e=!0,function(){var e,t;requirejs(["DS/PlatformAPI/PlatformAPI"],(e=>{window.PlatformAPI=e}));let o=(null===(e=window.widget)||void 0===e||null===(t=e.body)||void 0===t?void 0:t.querySelector("#root"))||document.getElementById("root");o||(o=document.createElement("div"),o.id="root",window.widget&&window.widget.body?window.widget.body.appendChild(o):document.body.appendChild(o)),U||(U=n.createRoot(o)),U.render((0,u.jsxs)(l.Kq,{store:a.A,children:[(0,u.jsx)(_,{}),(0,u.jsx)(r.N9,{})]}))}())}))}else console.error("[index.js] \u274c Widget not detected! onLoad cannot be registered.")}!function(){if(window.parent&&window.parent.document){let e=window.parent.document.createElement("script");e.textContent='\n    function listenForRefreshClicks() {\n      // console.log("\ud83c\udf0d [Parent] Listening for manual refresh clicks...");\n\n      document.body.addEventListener("click", function (event) {\n        let refreshButton = event.target.closest("#refresh"); // Check if refresh was clicked\n\n        if (refreshButton) {\n          // console.log("\u2705 [Parent] User clicked Refresh!");\n          sessionStorage.setItem("userClickedRefresh", "true"); // Store flag\n          // console.log("Stored Flag:", sessionStorage.getItem("userClickedRefresh"));\n        }\n      }, true);\n    }\n\n    // \u2705 Ensure event listener is added even if DOM is already loaded\n    if (document.readyState === "loading") {\n      document.addEventListener("DOMContentLoaded", listenForRefreshClicks);\n    } else {\n      listenForRefreshClicks();\n    }\n  ',window.parent.document.body.appendChild(e)}else console.warn("\u26a0\ufe0f [index.js] Unable to inject script\u2014parent window not accessible.")}()}}]);
//# sourceMappingURL=5.8db117ea.chunk.js.map